### React 组件的生命周期

##### `ComponentWillReceiveProps`

##### setState的时机

-   同步、异步的区分
    -   由React控制的事件处理程序，以及生命周期函数调用setState不会同步更新state
    -   React控制之外的事件中调用setState是同步更新的。比如原生js绑定的事件，setTimeout、setInterval等
-   同步、异步的控制
    -   在React的setState的函数实现中，会根据一个变量isBatchingUpdates判断是直接更新还是放在队列中延时更新
-   可以的方法
    -   `componentWillMount`、`componentDidMount`、`componentWillReceiveProps`、`componentDidUpdate`
-   其他的生命周期方法不可以
    -   产生死循环
    -   无意义

##### render次数 != 浏览器界面更新次数

### React router 原理以及使用

##### 前端路由、后端路由概念

##### react-router依赖基础- history

-   History整体介绍
    -   
-   点击`<Link>`到渲染的完整步骤
    -   
-   点击浏览器前进和后退发生了什么
    -   前进：window.location.hash = xxx
    -   后退：`hashChange`事件的监听，获取到和当前Url对应的location对象，其余步骤和点击`<Link>`的步骤保持一致
-   浏览器的Url中为什么会被添加一个`#`号
    -   因为使用了`hashHistory`。代表网页中的一个位置。其右面的字符，就是该位置的标识符。

##### 参考地址

[深入理解React Router原理](https://www.jianshu.com/p/53dc287a8020)

###  Redux（订阅发布机制）

##### 解决的问题

-   状态提升
-   避免共享状态能够随意的改变

##### 三大原则

-   整个应用的state被储存在一颗object tree中，并且这个object tree只存在于唯一一个store中
-   唯一改变state的方法就是触发action，action是一个用于描述事件的普通对象
-   为了描述action如何改变state tree，你需要编写reducers

##### Action

-   Action是把数据从项目传到store的有效载荷，它是store的唯一数据来源

##### Store

-   action描述发生了什么，reducers根据action更新state，Store就是把它们联系到一起的对象。Store有以下职责
    -   维持应用的state
    -   提供getState()方法获取state
    -   提供dispatch(action)方法更新state
    -   通过subscribe(lintener)注册监听器
    -   通过subscribe(lintener)返回的函数注销监听器

##### Reducer

-   纯函数：不修改函数的输入值，依赖于外部状态（比如数据库、DOM、全局变量）,同时对于任何相同的输入有着相同的输出结果

-   必须是纯函数的原因
    -   Redux只通过比较新旧两个对象的存储位置来比较新旧两个对象是否相同，即浅比较。因为深比较的代价比较昂贵，比较次数很多

##### 数据流

Redux应用中数据的生命周期遵循下面4个步骤

1.  调用store.dispatch(action)
2.  Redux store调用传入的reducer
3.  根reducer应该把多个子reducer输出合并成单一的state树
4.  Redux store 保存了根reducer返回的完整state树

##### 小结

-   subscriber：订阅，将参数push到处理数组
-   getState：返回state
-   dispatch：发布，遍历事件处理数组，并执行。调用reducer，传入state和action

### React Redux原理解析

##### 其实就是context和store的结合使用

##### Provider函数

-   Provider作为所有组件树的根节点，外界可以通过props给它提供store，它会把store放在自己的context里面，好让组件connect的时候都能获取到

-   核心函数`ConnectFunction`

##### connect如何更新

-   初始化

    当`Provider`组件被调用注册时，订阅更新`subscription`函数被注册

    `const subscription = new Subscription(store)`

-   订阅

-   发布（更新）